---
description:
globs:
alwaysApply: true
---

# Important
- üíã KISS - most simple solution. It's OK to leave `// TODO ..` if scope is to large

## Development Process
- **Type driven development** - When necessary adjust types and schemas first before implementing logic.
- **Run typecheck** - Run typecheck after changes via `bun run --cwd <domain> typecheck` and fix issues.
- **Named args** - use named arguments `(args: {foo: string})` over inline arguments `(foo: string)`
- **Shadcn** - never make changes to ./components/ui files
- Do not change `tsconfig.json`, ask permission with explaination if necessary
- NEVER EDIT files in `packages/db/migrations`. If needing to make database migrations ONLY edit `packages/db/src/schema.ts`.
    - never call db:generate or db:migrate

## React
// ‚ùå Requires React import
(e: React.ChangeEvent<HTMLInputElement>) => { ... }

// ‚úÖ Import the type directly
import { type ChangeEvent } from 'react'
(e: ChangeEvent<HTMLInputElement>) => { ... }


## Packages
- use package.json workspaces catalog for installing new dependancies

## Project Management
- If using the Linear MCP, the team is "kyoto"

## Current dev status

Current status: `in development`

The application is in early development with no users or deployment. Breaking changes and data migrations are not a concern. Do not leave any backwards compatibility except in database migrations.


## Package Review Summary

### Core Infrastructure Packages

**`@app/config`**
- Purpose: Centralized environment variable parsing and validation
- Value: Type-safe config with Zod validation; single source of truth for env vars
- Why it exists: Prevents config errors and provides consistent access across the monorepo

**`@app/schemas`**
- Purpose: Shared Zod schemas for the story evaluation flow
- Value: Type-safe data contracts between frontend/backend; documents the story flow (raw ‚Üí composition ‚Üí evaluation ‚Üí cache)
- Why it exists: Ensures type safety and consistency across the app

**`@app/db`**
- Purpose: Drizzle ORM database package
- Value: Type-safe database access, migrations, schema management
- Why it exists: Centralizes database logic and provides a consistent DB interface

**`@app/utils`**
- Purpose: General JavaScript utilities
- Value: Reusable helpers (type checking, noop, etc.)
- Why it exists: Shared utilities to avoid duplication

### API & Business Logic

**`@app/api`**
- Purpose: Server-side tRPC API definitions
- Value: Type-safe API layer with routers (user, org, repo, story, run, feedback, trigger)
- Why it exists: Centralizes all API endpoints with end-to-end type safety

### AI & Agent Packages

**`@app/agents`**
- Purpose: AI agent tooling and MCP integration
- Value: Orchestrates 10+ specialized agents (discovery, composition, evaluation, enrichment, impact analysis, etc.)
- Why it exists: Core AI functionality for story discovery, evaluation, and management

**`@app/vectra`**
- Purpose: Vector database helpers using vectra
- Value: Semantic search and embeddings for similarity
- Why it exists: Enables semantic search for stories and related content
